{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/kurultai/molt/steppe-visualization/app/api/agents/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\n\n// Gateway configuration\nconst GATEWAY_URL = process.env.GATEWAY_URL || 'http://localhost:18789';\nconst GATEWAY_TOKEN = process.env.GATEWAY_TOKEN || '';\n\n// Agent definitions matching the mission-control plan\nconst AGENT_DEFINITIONS = [\n  { id: 'main', name: 'Kublai', role: 'coordinator', sessionId: 'agent:main:main' },\n  { id: 'researcher', name: 'Möngke', role: 'researcher', sessionId: 'agent:researcher:main' },\n  { id: 'writer', name: 'Ögedei', role: 'writer', sessionId: 'agent:writer:main' },\n  { id: 'developer', name: 'Temüjin', role: 'developer', sessionId: 'agent:developer:main' },\n  { id: 'analyst', name: 'Jochi', role: 'analyst', sessionId: 'agent:analyst:main' },\n  { id: 'ops', name: 'Chagatai', role: 'operations', sessionId: 'agent:ops:main' },\n];\n\nexport const dynamic = 'force-dynamic';\nexport const revalidate = 0;\n\nasync function fetchFromGateway(endpoint: string) {\n  try {\n    const headers: Record<string, string> = {\n      'Accept': 'application/json',\n    };\n\n    if (GATEWAY_TOKEN) {\n      headers['Authorization'] = `Bearer ${GATEWAY_TOKEN}`;\n    }\n\n    const response = await fetch(`${GATEWAY_URL}${endpoint}`, {\n      headers,\n      signal: AbortSignal.timeout(5000),\n    });\n\n    if (response.ok) {\n      const data = await response.json();\n      return { success: true, data };\n    }\n\n    return { success: false, error: `HTTP ${response.status}` };\n  } catch (error) {\n    return { success: false, error: error instanceof Error ? error.message : 'Unknown error' };\n  }\n}\n\nexport async function GET() {\n  // Try to fetch from gateway\n  const sessionsResult = await fetchFromGateway('/api/sessions');\n\n  if (sessionsResult.success && sessionsResult.data) {\n    // Map gateway sessions to agent status\n    const agents = AGENT_DEFINITIONS.map(def => {\n      const sessionData = (sessionsResult.data as any[]).find(\n        (s: any) => s.sessionId === def.sessionId\n      );\n\n      return {\n        ...def,\n        status: sessionData ? 'working' : 'idle',\n        lastActive: sessionData?.lastActivity || null,\n        messageCount: sessionData?.messageCount || 0,\n      };\n    });\n\n    return NextResponse.json({\n      source: 'gateway',\n      agents\n    });\n  }\n\n  // Fallback: Return agent definitions with simulated status\n  return NextResponse.json({\n    source: 'fallback',\n    agents: AGENT_DEFINITIONS.map(def => ({\n      ...def,\n      status: 'idle',\n      lastActive: null,\n      messageCount: 0,\n    })),\n    gatewayError: sessionsResult.error,\n  });\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAEA,wBAAwB;AACxB,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW,IAAI;AAC/C,MAAM,gBAAgB,QAAQ,GAAG,CAAC,aAAa,IAAI;AAEnD,sDAAsD;AACtD,MAAM,oBAAoB;IACxB;QAAE,IAAI;QAAQ,MAAM;QAAU,MAAM;QAAe,WAAW;IAAkB;IAChF;QAAE,IAAI;QAAc,MAAM;QAAU,MAAM;QAAc,WAAW;IAAwB;IAC3F;QAAE,IAAI;QAAU,MAAM;QAAU,MAAM;QAAU,WAAW;IAAoB;IAC/E;QAAE,IAAI;QAAa,MAAM;QAAW,MAAM;QAAa,WAAW;IAAuB;IACzF;QAAE,IAAI;QAAW,MAAM;QAAS,MAAM;QAAW,WAAW;IAAqB;IACjF;QAAE,IAAI;QAAO,MAAM;QAAY,MAAM;QAAc,WAAW;IAAiB;CAChF;AAEM,MAAM,UAAU;AAChB,MAAM,aAAa;AAE1B,eAAe,iBAAiB,QAAgB;IAC9C,IAAI;QACF,MAAM,UAAkC;YACtC,UAAU;QACZ;QAEA,IAAI,eAAe;YACjB,OAAO,CAAC,gBAAgB,GAAG,CAAC,OAAO,EAAE,eAAe;QACtD;QAEA,MAAM,WAAW,MAAM,MAAM,GAAG,cAAc,UAAU,EAAE;YACxD;YACA,QAAQ,YAAY,OAAO,CAAC;QAC9B;QAEA,IAAI,SAAS,EAAE,EAAE;YACf,MAAM,OAAO,MAAM,SAAS,IAAI;YAChC,OAAO;gBAAE,SAAS;gBAAM;YAAK;QAC/B;QAEA,OAAO;YAAE,SAAS;YAAO,OAAO,CAAC,KAAK,EAAE,SAAS,MAAM,EAAE;QAAC;IAC5D,EAAE,OAAO,OAAO;QACd,OAAO;YAAE,SAAS;YAAO,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAAgB;IAC3F;AACF;AAEO,eAAe;IACpB,4BAA4B;IAC5B,MAAM,iBAAiB,MAAM,iBAAiB;IAE9C,IAAI,eAAe,OAAO,IAAI,eAAe,IAAI,EAAE;QACjD,uCAAuC;QACvC,MAAM,SAAS,kBAAkB,GAAG,CAAC,CAAA;YACnC,MAAM,cAAc,AAAC,eAAe,IAAI,CAAW,IAAI,CACrD,CAAC,IAAW,EAAE,SAAS,KAAK,IAAI,SAAS;YAG3C,OAAO;gBACL,GAAG,GAAG;gBACN,QAAQ,cAAc,YAAY;gBAClC,YAAY,aAAa,gBAAgB;gBACzC,cAAc,aAAa,gBAAgB;YAC7C;QACF;QAEA,OAAO,mLAAY,CAAC,IAAI,CAAC;YACvB,QAAQ;YACR;QACF;IACF;IAEA,2DAA2D;IAC3D,OAAO,mLAAY,CAAC,IAAI,CAAC;QACvB,QAAQ;QACR,QAAQ,kBAAkB,GAAG,CAAC,CAAA,MAAO,CAAC;gBACpC,GAAG,GAAG;gBACN,QAAQ;gBACR,YAAY;gBACZ,cAAc;YAChB,CAAC;QACD,cAAc,eAAe,KAAK;IACpC;AACF"}}]
}