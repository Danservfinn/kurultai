// OpenClaw Gateway Configuration for Kurultai v0.2
// Deployed to Railway at kublai.kurult.ai
// Reference: https://docs.openclaw.ai/gateway/configuration
{
  // Gateway settings
  gateway: {
    port: 18789,
    bind: "lan",
    mode: "local",
    auth: {
      mode: "token",
      token: "${OPENCLAW_GATEWAY_TOKEN}",
    },
    controlUi: {
      enabled: true,
      // Authentik handles auth at proxy layer — allow webchat without device identity
      allowInsecureAuth: true,
      dangerouslyDisableDeviceAuth: true,
    },
    // Trust Railway's internal proxy for X-Forwarded-* headers
    trustedProxies: ["10.0.0.0/8", "172.16.0.0/12", "192.168.0.0/16", "100.64.0.0/10"],
  },

  // Agent configuration
  // Uses built-in "kimi-coding" provider (Anthropic-compatible endpoint at api.kimi.com/coding/)
  // IMPORTANT: Built-in providers ignore custom baseUrl — must use correct provider name
  agents: {
    defaults: {
      model: {
        primary: "kimi-coding/k2p5",
      },
      // Custom SOUL.md files are 20-35K chars; default limit (20K) truncates them
      bootstrapMaxChars: 50000,
      // We manage workspace files ourselves — don't let OpenClaw overwrite with templates
      skipBootstrap: true,
    },
    // Kurultai's 6 agents — each with its own workspace containing SOUL.md + CLAUDE.md
    // OpenClaw loads SOUL.md, CLAUDE.md, IDENTITY.md etc. from workspace root at session start
    list: [
      { id: "main", name: "Kublai", workspace: "/data/workspace/souls/main" },
      { id: "researcher", name: "Möngke", workspace: "/data/workspace/souls/researcher" },
      { id: "writer", name: "Chagatai", workspace: "/data/workspace/souls/writer" },
      { id: "developer", name: "Temüjin", workspace: "/data/workspace/souls/developer" },
      { id: "analyst", name: "Jochi", workspace: "/data/workspace/souls/analyst" },
      { id: "ops", name: "Ögedei", workspace: "/data/workspace/souls/ops" },
    ],
  },

  // Signal channel configuration
  // OpenClaw autoStarts signal-cli daemon — data must be at $HOME/.local/share/signal-cli/
  // With HOME=/data, that means /data/.local/share/signal-cli/data/accounts.json
  channels: {
    signal: {
      enabled: true,
      account: "${SIGNAL_ACCOUNT}",
      // Wrapper adds --trust-new-identities always to handle identity key changes
      cliPath: "/app/signal-cli-wrapper.sh",
      httpHost: "127.0.0.1",
      httpPort: 8080,
      startupTimeoutMs: 120000,
      receiveMode: "on-start",
      dmPolicy: "open",
      groupPolicy: "allowlist",
      configWrites: true,
      allowFrom: ["+15165643945", "+19194133445"],
      historyLimit: 50,
      textChunkLimit: 4000,
      ignoreStories: true,
    },
  },

  // Logging
  logging: {
    consoleLevel: "debug",
    file: "/data/logs/openclaw.log",
  },

  // Plugins — explicitly enable Signal so doctor doesn't block it
  plugins: {
    allow: ["signal"],
    entries: {
      signal: { enabled: true },
    },
  },

  // Environment — only pass safe env vars to agent sandboxes
  // SECURITY: Do NOT use enabled:true (leaks all secrets including tokens/passwords)
  env: {
    shellEnv: {
      enabled: false,
    },
  },
}
